# SQL Server Change Data Capture

SQL Server å¾?2008 ?ˆæœ¬?‹å??ä? Change Data Capture (CDC) ?„å??½ï?ä½†åª?æ–¼ Enterprise ??Developer Edition ?æ?ä¾›ã€‚ä??è‡ª SQL Server 2016 ?‹å??™å€‹å¥½?¨ç??Ÿèƒ½ä¸‹æ”¾??Standard Editionï¼Œç‚º?‹ç™¼?…å¸¶ä¾†ä?å°‘ä¾¿?©ï?

![](<assets/image (20).png>)

è¦åˆ¤?·CDC ?¯å¦?‹å?ï¼Œå¯ä»¥æŸ¥è©?sys.databases è³‡æ?åº«å…§æ¯ä??‹è??™åº«?ç¨±å°æ?ä¹?is\_cdc\_enabled æ¬„ä??„å€¼ï?0è¡¨ç¤º?ªé??Ÿï?1ä»?¡¨?‹å???

?·è? sp\_cdc\_enable\_db ?™éš»?å„²ç¨‹å??½é???CDCï¼Œå?ä¹?sp\_cdc\_disable\_db ?¯ä»¥?œé?å®ƒã€?

```sql
EXEC sp_cdc_enable_db 
```

![SQL Server ?ä? 20 å¤šå€?CDC ?¸é??„ç³»çµ±é??²ç?åº](<assets/image (19).png>)

![?‹å? CDC å¾Œå¯ä»¥åœ¨ç³»çµ±è³‡æ?è¡¨å?ä¸‹ç??°ä?ç³»å? cdc ?‹é ­?„è??™è¡¨](<assets/image (18).png>)

?¥è?å°±è?ä½¿ç”¨ sp\_cdc\_enable\_table ?å„²ç¨‹å?è¨­å?è¦?CDC ç´€?„ç?è³‡æ?è¡?

```sql
EXEC sp_cdc_enable_table
    @source_schema = 'dbo',
    @source_name = '/è³‡æ?è¡¨å?ç¨?',
    @role_name = 'cdc_admin'
```

![](<assets/image (21).png>)

?‰ç”±\_$start\_lsn æ¬„ä?ï¼Œèƒ½?¤æ–·?¯å?ä¸€?¹æ¬¡ä¿®æ”¹ä¹‹äº¤??transaction)ç´€?„ã€?

&#x20;\_$seqval æ¬„ä??¼ç›¸?Œå?è¡¨ç¤º?Œä?ç­†ä¿®?¹ç”¢?Ÿç?ç´€?„ã€?

&#x20;\_$updatemaskæ¬„ä??Ÿæœ¬?¯ä»¥?å…­?²ä??²å?ï¼Œå???0x000800ï¼Œè?äºŒé€²ä?100000000000ï¼Œç”±?³å?å·¦æ•¸1 ?¨ç¬¬12ä½ç½®ï¼Œå°±ä»?¡¨ç¬?2?‹æ?ä½æ??°å???

\_$operation æ¬„ä??¸å??‰ä»¥ä¸‹å«ç¾©ï?

\_$operation = 1ï¼Œä»£è¡¨è??™è¢«?ªé™¤

&#x20;\_$operation = 2ï¼Œè¡¨ç¤ºè??™è¢«?°å?

\_$operation = 3 ??4ï¼? ?ºç•°?•å??„è??™ï?4 ?‡æ˜¯?°å?å¾Œç?è³‡æ?

